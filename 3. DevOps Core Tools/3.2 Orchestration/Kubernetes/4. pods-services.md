---
title: "• Pods-Services"
parent: "• Kubernetes"
grand_parent: "• 3.2 Orchestration"
great_grand_parent: 3. DevOps Core Tools
nav_order: 4
has_children: true
---

# Pods & Services

- Pod definition
- ClusterIP, NodePort, LoadBalancer


-----------------------------------

---

# **Kubernetes Master Class – Clean & Organized Notes**

---

# **Step 1 — Software Installation**

### **Install Required Tools**

* Docker
* Kubernetes tools

  * **kind**
  * **minikube**
  * **kubeadm**
  * **EKS / AWS**
  * **GKE (Google Cloud)**

---

# **Step 2 — Create Kubernetes Cluster (Kind)**

## **Kind Cluster Configuration File**

Create a file:

```
vim config.yml
```

Paste:

```yaml
# Multi-node (1 control-plane + 3 workers) Kind cluster config
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    image: kindest/node:v1.31.2

  - role: worker
    image: kindest/node:v1.31.2

  - role: worker
    image: kindest/node:v1.31.2

  - role: worker
    image: kindest/node:v1.31.2
    extraPortMappings:
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      - containerPort: 443
        hostPort: 443
        protocol: TCP
```

---

## **Create the Cluster**

```bash
sudo kind create cluster --name=tws-cluster --config=config.yml
```

---

## **Verify Cluster**

### **Check cluster info**

```bash
sudo kubectl cluster-info --context kind-tws-cluster
```

Example output:

```
Kubernetes control plane is running at https://127.0.0.1:33889
CoreDNS running at https://127.0.0.1:33889/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
```

### **List Nodes**

```bash
sudo kubectl get nodes
```

Example output:

```
NAME                        STATUS   ROLES           VERSION
tws-cluster-control-plane   Ready    control-plane   v1.31.2
tws-cluster-worker          Ready    <none>          v1.31.2
tws-cluster-worker2         Ready    <none>          v1.31.2
tws-cluster-worker3         Ready    <none>          v1.31.2
```

---

# **Error Handling & Solutions**

---

## ❌ **Error 1: Docker permission denied**

```
docker: Not healthy: permission denied while trying to connect to docker.sock
```

### ✅ **Solution**

```bash
sudo usermod -aG docker $USER
newgrp docker
```

---

## ❌ **Error 2: RSRC_INSUFFICIENT_CORES**

```
Docker has less than 2 CPUs available, but Kubernetes requires at least 2
```

### **Check CPU Allocation**

```bash
docker info | grep -i cpu
```

### **Fix Docker Daemon Config**

```
sudo vim /etc/docker/daemon.json
```

Add/update:

```json
{
  "default-runtime": "runc",
  "runtimes": {
    "runc": {
      "path": "runc"
    }
  },
  "cpu-period": 100000,
  "cpu-quota": 200000
}
```

### **Restart Docker**

```bash
sudo systemctl restart docker
```

### **Retry Minikube**

```bash
minikube start --driver=docker
```

---

# **Additional Commands**

### Switch kubectl context

```bash
kubectl config use-context kind-tws-cluster
```

---


Below is your **complete, clean, fully structured, interview-ready Kubernetes notes** for:

✔ Namespace
✔ Pods
✔ Deployments
✔ ReplicaSets
✔ DaemonSets
✔ Jobs
✔ CronJobs

Everything is arranged professionally.

---

# **Kubernetes Master Class – Step 3 to Step 7 (Clean Notes)**

---

# **Step 3 — NGINX Deployment (Namespace → Pod → Deployment → Service)**

## **Namespaces (Logical Grouping)**

### Create namespace

```bash
kubectl create ns nginx
kubectl get ns
```

### Delete namespace

```bash
kubectl delete ns nginx
```

---

# **Step 4 — Pods (Imperative & Declarative)**

## **Imperative Pod Commands**

### Create a pod (default namespace)

```bash
kubectl run nginx --image=nginx
kubectl get pods
kubectl delete pod nginx
```

### Create pod inside namespace "nginx"

```bash
kubectl run nginx -n nginx --image=nginx
kubectl get pods -n nginx
```

### Delete pod

```bash
kubectl delete pod nginx -n nginx
```

---

## **Declarative Pod Manifest (pod.yml)**

**namespace.yml**

```yaml
kind: Namespace
apiVersion: v1
metadata:
  name: nginx
```

**pod.yml**

```yaml
kind: Pod
apiVersion: v1
metadata:
  name: nginx-pod
  namespace: nginx
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
```

### Apply & verify

```bash
kubectl apply -f namespace.yml
kubectl apply -f pod.yml
kubectl get pod -n nginx
```

### Enter into container

```bash
kubectl exec -it nginx-pod -n nginx -- bash
curl 127.0.0.1
```

### Describe pod

```bash
kubectl describe pod/nginx-pod -n nginx
```

### Delete pod manifest

```bash
kubectl delete -f pod.yml
```

---

# **Step 5 — Deployment**

## **deployment.yml**

```yaml
kind: Deployment
apiVersion: apps/v1
metadata:
  name: nginx-deployment
  namespace: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx

  template:
    metadata:
      name: nginx-dep-pod
      labels:
        app: nginx

    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
```

### Apply deployment

```bash
kubectl apply -f deployment.yml
```

### List deployments & pods

```bash
kubectl get deployment -n nginx
kubectl get pods -n nginx
```

## **Scale deployment**

```bash
kubectl scale deployment/nginx-deployment -n nginx --replicas=5
```

## **Check pods with node info**

```bash
kubectl get pods -n nginx -o wide
```

---

# **Rolling Update**

### Update nginx version

```bash
kubectl set image deployment/nginx-deployment nginx=nginx:1.29.0 -n nginx
```

### Roll back to latest

```bash
kubectl set image deployment/nginx-deployment nginx=nginx:latest -n nginx
```

---

# **Delete deployment**

```bash
kubectl delete -f deployment.yml
```

---

# **Step 6 — ReplicaSet**

## **replicaset.yml**

```yaml
kind: ReplicaSet
apiVersion: apps/v1
metadata:
  name: nginx-replicasets
  namespace: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx

  template:
    metadata:
      name: nginx-dep-pod
      labels:
        app: nginx

    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
```

### Apply ReplicaSet

```bash
kubectl apply -f replicaset.yml
kubectl get replicasets -n nginx
kubectl delete -f replicaset.yml
```

---

# **Step 7 — DaemonSet**

DaemonSet = **Run exactly 1 pod on each node**
Used for:

* Monitoring agents
* Logging agents
* Network plugins

## **daemonset.yml**

```yaml
kind: DaemonSet
apiVersion: apps/v1
metadata:
  name: nginx-daemonsets
  namespace: nginx
spec:
  selector:
    matchLabels:
      app: nginx

  template:
    metadata:
      name: nginx-dmm-pod
      labels:
        app: nginx

    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
```

### Commands

```bash
kubectl apply -f daemonset.yml
kubectl get pods -n nginx
kubectl get pods -n nginx -o wide     # check node-wise placement
kubectl get replicasets -n nginx
kubectl delete -f daemonset.yml
```

---

# **Step 8 — Jobs**

Jobs = **One-time tasks**
Use cases:

* Backup
* Patching
* Batch processing

## **job.yml**

```yaml
kind: Job
apiVersion: batch/v1
metadata:
  name: demo-job
  namespace: nginx
spec:
  completions: 1
  parallelism: 1
  template:
    metadata:
      name: demo-job-pod
      labels:
        app: batch-task
    spec:
      containers:
      - name: batch-container
        image: busybox:latest
        command: ["sh", "-c" ,"echo hello Dosto ! && sleep 10"]
      restartPolicy: Never
```

### Commands

```bash
kubectl apply -f job.yml
kubectl get job -n nginx
kubectl get pods -n nginx
kubectl logs pod/<job-pod-name> -n nginx
kubectl delete -f job.yml
```

---

# **Step 9 — CronJob**

CronJobs = **Scheduled Jobs**
Runs at specific time/frequency.

## **cron-job.yml**

```yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: minute-backup
  namespace: nginx
spec:
  schedule: "* * * * *"         # Every minute
  jobTemplate:
    spec:
      template:
        metadata:
          name: minute-backup
          labels:
            app: minute-backup
        spec:
          containers:
          - name: backup-container
            image: busybox
            command:
            - sh
            - -c
            - >
              echo "Backup Started" ;
              mkdir -p /backups &&
              mkdir -p /demo-data &&
              cp -r /demo-data /backups &&
              echo "Backup Completed" ;
            volumeMounts:
            - name: data-volume
              mountPath: /demo-data
            - name: backup-volume
              mountPath: /backups
          restartPolicy: OnFailure
          volumes:
          - name: data-volume
            hostPath:
              path: /demo-data
              type: DirectoryOrCreate
          - name: backup-volume
            hostPath:
              path: /backup
              type: DirectoryOrCreate
```

### Commands

```bash
kubectl apply -f cron-job.yml
kubectl get pod -n nginx
kubectl logs pod/<cronjob-pod-name> -n nginx
kubectl delete -f cron-job.yml
```

---