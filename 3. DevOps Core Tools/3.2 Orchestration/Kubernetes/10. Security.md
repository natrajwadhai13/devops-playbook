---
title: "10. Security"
parent: "â€¢ Kubernetes"
grand_parent: 3. DevOps Core Tools
nav_order: 10
has_children: true
---
Topics Included - Pod Security Standards (PSS), Image Scanning, Network Policies

Sub-Sections / Deep-Dive Areas - Secrets Encryption, mTLS, RBAC Hardening

---


# ğŸ“Œ Kubernetes: ConfigMaps & Secrets

## ğŸ”· 1. ConfigMaps

### âœ… **What is a ConfigMap?**

ConfigMap is a Kubernetes API object used to store **non-confidential configuration data** in **key-value pairs**.
It allows you to separate configuration from container images, making applications **portable and easier to manage**.

---

### âœ… **Why use ConfigMaps?**

* To avoid hardcoding configuration inside Docker images.
* To manage configuration externally and update without rebuilding the image.
* To share configuration across multiple pods or microservices.
* Helps in environment-specific setups (dev, qa, prod).

---

### ğŸ¯ **Common use cases**

* Application settings (app name, ENV variables).
* Database name, host, port.
* URLs, feature flags.
* Any non-sensitive configuration.

---

### ğŸ“Œ Important points

* ConfigMaps are **not encrypted**.
* Not meant for sensitive data.
* Pods automatically restart only if configuration is mounted as a file and data changes.

---

# ğŸ”· 2. Secrets

### âœ… **What is a Secret?**

Kubernetes Secret is used to store **sensitive data** such as passwords, tokens, certificates, keys, etc.

Secrets store data in **base64 encoded** format (not encryption but prevents accidental viewing).

---

### ğŸ¯ **Why use Secrets?**

* To securely store sensitive information.
* To avoid exposing credentials inside YAML files.
* To follow security best practices for cloud-native apps.

---

### ğŸ”’ **Types of Secrets**

* `Opaque` â€“ user-defined key-value secrets (most common)
* `docker-registry` â€“ used for private container registry authentication
* TLS secrets â€“ used for HTTPS

---

### ğŸ“Œ Important points

* Secrets are base64 encoded, not fully encrypted.
* Use Kubernetes Encryption at Rest (optional) for major security.
* Avoid committing secrets to GitHub.
* RBAC can restrict access to secrets.
* Safer than ConfigMaps for sensitive data.

---

# ğŸ”¥ ConfigMap vs Secret (Summary)

| Feature               | ConfigMap     | Secret                   |
| --------------------- | ------------- | ------------------------ |
| Stores sensitive data | âŒ No          | âœ… Yes                    |
| Base64 encoding       | âŒ No          | âœ… Yes                    |
| Typical use           | App config    | Passwords, tokens        |
| Encryption            | Not encrypted | Can be encrypted at rest |
| Kubectl object type   | ConfigMap     | Secret                   |


---

# âœ… **Kubernetes â€“ ConfigMap, Secret & StatefulSet (MySQL Setup)**

This guide explains how to deploy MySQL using **ConfigMaps**, **Secrets**, and **StatefulSets** in Kubernetes.
StatefulSets are used for **database workloads** because they ensure **stable storage**, **persistent identity**, and **ordered deployment**.

---

# -----------------------------------------------------

# ğŸ”¹ **1. Create Namespace**

```yaml
# namespace.yml
apiVersion: v1
kind: Namespace
metadata:
  name: mysql
```

Apply:

```bash
kubectl apply -f namespace.yml
```

---

# -----------------------------------------------------

# ğŸ”¹ **2. Create ConfigMap (Non-confidential settings)**

ConfigMaps store **plain-text configuration values**, such as database names.

### **configMap.yml**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config-map
  namespace: mysql
data:
  MYSQL_DATABASE: devops
```

Apply:

```bash
kubectl apply -f configMap.yml
```

---

# -----------------------------------------------------

# ğŸ”¹ **3. Create Secret (Sensitive values like passwords)**

Kubernetes Secrets store sensitive information in **base64 encoded** form.

Encode password:

```bash
echo -n "root" | base64
```

### **secrets.yml**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: mysql-secret
  namespace: mysql
data:
  MYSQL_ROOT_PASSWORD: cm9vdA==
```

Apply:

```bash
kubectl apply -f secrets.yml
```

---

# -----------------------------------------------------

# ğŸ”¹ **4. Create StatefulSet for MySQL**

StatefulSet ensures:

âœ” Stable network identity
âœ” Persistent storage
âœ” Ordered startup/shutdown
âœ” Ideal for databases

### **statefulset.yml**

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql-statefulset
  namespace: mysql

spec:
  serviceName: mysql-service
  replicas: 3
  selector:
    matchLabels:
      app: mysql

  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        ports:
        - containerPort: 3306

        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD

        - name: MYSQL_DATABASE
          valueFrom:
            configMapKeyRef:
              name: mysql-config-map
              key: MYSQL_DATABASE

        volumeMounts:
        - name: mysql-data
          mountPath: /var/lib/mysql

  volumeClaimTemplates:
  - metadata:
      name: mysql-data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 1Gi
```

Apply:

```bash
kubectl apply -f statefulset.yml
```

---

# -----------------------------------------------------

# ğŸ”¹ **5. Verify Resources**

### Check pods:

```bash
kubectl get pods -n mysql
```

### Check ConfigMap:

```bash
kubectl get configmap -n mysql
```

### Check Secret:

```bash
kubectl get secret -n mysql
```

### Check PVC:

```bash
kubectl get pvc -n mysql
```

---

# -----------------------------------------------------

# ğŸ”¹ **6. Connect to MySQL Pod**

Open a terminal inside Pod:

```bash
kubectl exec -it < docker contener name > -n mysql -- bash
kubectl exec -it mysql-statefulset-0 -n mysql -- bash
```

Login MySQL:

```bash
mysql -u root -p
```

Enter password: **root**

Check databases:

```sql
show databases;
```

Expected output:

```
devops
information_schema
mysql
performance_schema
sys
```

---

# -----------------------------------------------------

# ğŸ”¹ **7. Delete Everything (Complete Cleanup)**

ğŸ‘‰ **Easiest & recommended method:**
Delete *entire namespace* â†’ everything gets removed:

```bash
kubectl delete namespace mysql
```

OR if created using YAML:

```bash
kubectl delete -f namespace.yml
```
